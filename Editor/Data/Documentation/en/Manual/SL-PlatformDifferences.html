<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual: Platform specific rendering differences</title>
<meta name="description" content="The Unity Manual helps you learn and use the Unity engine. With the Unity engine you can create 2D and 3D games, apps and experiences.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFilesManual/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2854981-1']);
  _gaq.push(['_setDomainName', 'unity3d.com']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=1503962755"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=1503962755"></script><script type="text/javascript" src="docdata/toc.js?ts=1503962755"></script><script type="text/javascript" src="docdata/global_toc.js?ts=1503962755"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=1503962755">
</head>
<body>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="http://unity3d.com/">unity3d.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-number">Version: <b>5.4 beta</b> (<a href="http://docs.unity3d.com/530/Documentation/Manual">switch to 5.3</a>)</div>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language: <span class="b">English</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/">English</a></li>
<li><a href="/ja/current/Manual/">日本語</a></li>
<li><a href="/es/current/Manual/">Español</a></li>
<li><a href="/kr/current/Manual/">한국어</a></li>
<li><a href="/ru/current/Manual/">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc"><h2>Unity Manual</h2></div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity Manual</a></li>
<li><a href="Graphics.html">Graphics</a></li>
<li><a href="GraphicsReference.html">Graphics Reference</a></li>
<li><a href="SL-Reference.html"> Shader Reference</a></li>
<li><a href="SL-AdvancedTopics.html">Advanced ShaderLab topics</a></li>
<li>Platform specific rendering differences</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="SL-CameraDepthTexture.html"></a></span><div class="tip"> Camera's Depth Texture</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="SL-ShaderLOD.html"></a></span><div class="tip">Shader Level of Detail</div>
</div>
</div></div>
<h1>Platform specific rendering differences</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Unity runs on various platforms, and in some cases there are differences in how things behave. Most of the time Unity hides the differences from you, but sometimes issues can occur.</p>

<h2>Render Texture coordinates</h2>

<p>Vertical texture coordinate conventions differ between Direct3D-like and OpenGL-like platforms:</p>

<ul>
<li>In Direct3D, Metal and consoles, the coordinate is zero at the top, and increases downwards.</li>
<li>In OpenGL and OpenGL ES, the coordinate is zero at the bottom, and increases upwards.</li>
</ul>

<p>Most of the time this does not really matter, except when rendering into a <a href="class-RenderTexture.html">Render Texture</a>. In that case, Unity internally flips rendering upside down when rendering into a texture on non-OpenGL, so that the conventions match between the platforms. Two common cases where this needs to be handled in the shaders are image effects and rendering things in UV space.</p>

<h4>Image Effects, upside-down RenderTextures, and MSAA</h4>

<p>One case where the above “on non-OpenGL, render upside down when rendering into a texture” does not happen, is when <a href="WritingImageEffects.html">Image Effects</a> and anti-aliasing is used. In this case, Unity renders to screen to get anti-aliasing, and then “resolves” rendering into a RenderTexture for further processing with an Image Effect. The resulting source texture for an image effect is <strong>not</strong> flipped upside down on Direct3D/Metal (unlike all other Render Textures).</p>

<p>If your Image Effect is a simple one (processing one texture at a time) then this does not really matter, because <a href="../ScriptReference/Graphics.Blit.html">Graphics.Blit</a> takes care of that.</p>

<p>However, if you’re processing more than one RenderTexture together in your Image Effect, they are likely to come out at different vertical orientations (only in Direct3D-like platforms, and only when anti-aliasing is used). You need to manually “flip” the screen texture upside down in your vertex shader, like this:</p>

<pre><code>// On non-GL when AA is used, the main texture and scene depth texture
// will come out in different vertical orientations.
// So flip sampling of the texture when that is the case (main texture
// texel size will have negative Y).

#if UNITY_UV_STARTS_AT_TOP
if (_MainTex_TexelSize.y &lt; 0)
        uv.y = 1-uv.y;
#endif
</code></pre>

<p>Refer to the Edge Detection scene in the <a href="http://unity3d.com/support/resources/example-projects/shader-replacement">Shader Replacement sample project</a> for an example of this. Edge detection there uses both the screen texture and the Camera’s <a href="SL-CameraDepthTexture.html">Depth+Normals texture</a>.</p>

<h4>Rendering in UV space</h4>

<p>When rendering in texture coordinate (UV) space for special effects or
tools, you might need to adjust your shaders so that the rendering is
consistent between D3D-like and OpenGL-like systems, and between rendering into the
screen vs. rendering into a texture. The <a href="SL-UnityShaderVariables.html">built-in variable</a> <code>_ProjectionParams.x</code> contains a +1 or –1 value which indicates whether projection has been flipped upside down or not. You can check this value in your shaders if you need to do different things based on this.</p>

<pre><code>float4 vert(float2 uv : TEXCOORD0) : SV_POSITION
{
    float4 pos;
    pos.xy = uv;
    // we're rendering with upside-down flipped projection,
    // so flip the vertical UV coordinate too
    if (_ProjectionParams.x &lt; 0)
        pos.y = 1 - pos.y;
    pos.z = 0;
    pos.w = 1;
    return pos;
}
</code></pre>

<h2>Clip space coordinate differences</h2>

<p>Just like with texture coordinates, the clip space coordinates (also known as post-projection space coordinates) differ between Direct3D-like and OpenGL-like platforms:</p>

<ul>
<li>In Direct3D, Metal and consoles, the clip space depth goes from 0.0 at the near plane, to +1.0 at the far plane.</li>
<li>In OpenGL and OpenGL ES, the clip space depth goes from –1.0 at the near plane, to +1.0 at the far plane.</li>
</ul>

<p>Inside shader code, you can use <code>UNITY_NEAR_CLIP_VALUE</code> <a href="SL-BuiltinMacros.html">macro</a> to get the near plane value based on platform.</p>

<p>Inside script code, <a href="../ScriptReference/GL.GetGPUProjectionMatrix.html">GL.GetGPUProjectionMatrix</a> can be used to convert from Unity’s coordinate system (which follows OpenGL conventions) to what the platform expects.</p>

<h2>Precision of shader computations</h2>

<p>PC GPUs treat all floating point types (<code>float</code>, <code>half</code> and
<code>fixed</code>) as the same, and do all calculations using full 32 bit
precision. Many mobile GPUs do not do this, so make
sure to test your shaders on the target platform to avoid precision issues.
See the <a href="SL-DataTypesAndPrecision.html">data types and precision</a> page
for details.</p>

<h2>Const declarations in shaders</h2>

<p>In HLSL <code>const</code> has much the same meaning as it does in C# and C++, such that the variable declared is read-only within its scope, but can be initialised in any way.</p>

<p>In GLSL however, <code>const</code> means that the variable is effectively a compile time constant, and so must be initialised with compile time constants - either literal values, or calculations on other constants.</p>

<p>It is best to follow the GLSL semantics and only declare a variable as <code>const</code> when it is truly invariant, and avoid initialising a <code>const</code> variable with some other mutable values e.g. as a local variable in a function. This will work just fine in HLSL and avoid confusing errors on only some platforms.</p>

<h2>Const declarations in shaders</h2>

<p>In HLSL <code>const</code> has much the same meaning as it does in C# and C++, such that the variable declared is read-only within its scope, but can be initialised in any way.</p>

<p>In GLSL however, <code>const</code> means that the variable is effectively a compile time constant, and so must be initialised with compile time constants - either literal values, or calculations on other constants.</p>

<p>It is best to follow the GLSL semantics and only declare a variable as <code>const</code> when it is truly invariant, and avoid initialising a <code>const</code> variable with some other mutable values e.g. as a local variable in a function. This will work just fine in HLSL and avoid confusing errors on only some platforms.</p>

<h2>Semantics used by shaders</h2>

<p>To get shaders working on all platforms, some special shader values should use these <a href="SL-ShaderSemantics.html">semantics</a>:</p>

<ul>
<li>
<strong>Vertex shader output (clip space) position:</strong> <code>SV_POSITION</code>. Sometimes shaders use <code>POSITION</code> semantics for that, but this does not not work on Sony PS4 or when tessellation is used.</li>
<li>
<strong>Fragment shader output color:</strong> <code>SV_Target</code>. Sometimes shaders use <code>COLOR</code> or <code>COLOR0</code> for that, but again this does not work on PS4.</li>
</ul>

<p>When rendering meshes as Points, make sure to output <code>PSIZE</code> semantics from the vertex shader (for example, set it to 1). Some platforms, such as OpenGL ES or Metal, treat point size as “undefined” when it’s not written to from the shader.</p>

<p>See the <a href="SL-ShaderSemantics.html">shader semantics</a> page for more details.</p>

<h2>Direct3D 9 / 11 shader compiler is stricter about syntax</h2>

<p>Direct3D platforms use Microsoft’s <a href="SL-ShadingLanguage.html">HLSL shader compiler</a>. The HLSL compiler is stricter than other compilers about various subtle shader errors. For example, it doesn’t accept function output values that aren’t initialized properly.</p>

<p>The most common places you might run into this are:</p>

<ul>
<li>
<strong>A <a href="SL-SurfaceShaders.html">Surface shader</a> vertex modifier that has an “out” parameter.</strong> Make sure to initialize the output like this:</li>
</ul>

<pre><code>      void vert (inout appdata_full v, out Input o) 
      {
        **UNITY_INITIALIZE_OUTPUT(Input,o);**
        // ...
      }
</code></pre>

<ul>
<li>
<strong>Partially initialized values.</strong> For example, a function returns <code>float4</code>, but the code only sets the .xyz values of it. Make sure to set all values, or change to <code>float3</code> if you only need three values.</li>
<li>
<strong>Using <code>tex2D</code> in the vertex shader.</strong> This is not valid, as UV derivatives don’t exist in the vertex shader. You need to sample an explicit mip level instead; for example, use <code>tex2Dlod (tex, float4(uv,0,0))</code>. You also need to add <code>#pragma target 3.0</code>, as <code>tex2Dlod</code> is a shader model 3.0 feature.</li>
</ul>

<h2>DirectX 11 HLSL syntax and Surface Shaders</h2>

<p>Some parts of the <a href="SL-SurfaceShaders.html">surface shader</a> compilation pipeline do not understand DX11-specific HLSL syntax. If you’re using HLSL features like StructuredBuffers, RWTextures and other non-DX9 syntax, wrap them in a DX11-only preprocessor macro:</p>

<pre><code>#ifdef SHADER_API_D3D11
// DX11-specific code, e.g.
StructuredBuffer&lt;float4&gt; myColors;
RWTexture2D&lt;float4&gt; myRandomWriteTexture;
#endif
</code></pre>

<h2>Using Shader Framebuffer Fetch</h2>

<p>Some GPUs (most notably PowerVR based ones on iOS) allow you to do a form of programmable blending by providing current fragment color as input to the fragment shader (see <a href="https://www.khronos.org/registry/gles/extensions/EXT/EXT_shader_framebuffer_fetch.txt">EXT_shader_framebuffer_fetch</a>).</p>

<p>It is possible to write shaders in Unity that use the framebuffer fetch functionality. When writing HLSL/Cg fragment shader, simply use the <code>inout</code> color argument in it. For example:</p>

<pre><code>CGPROGRAM
// only compile shader for platforms that can potentially
// do it (currently gles,gles3,metal)
#pragma only_renderers framebufferfetch

void frag (v2f i, inout half4 ocol : SV_Target)
{
    // ocol can be read (current framebuffer color)
    // and written into (will change color to that one)
    // ...
}   
ENDCG
</code></pre>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="SL-CameraDepthTexture.html"></a></span><div class="tip"> Camera's Depth Texture</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="SL-ShaderLOD.html"></a></span><div class="tip">Shader Level of Detail</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">
<known_issues><p>Is something described here not working as you expect it to? It might be a <b>Known Issue</b>. Please check with the Issue Tracker at <a href="http://issuetracker.unity3d.com">issuetracker.unity3d.com</a>.</p></known_issues>Copyright © 2016 Unity Technologies. Publication 5.4b-R</div>
<div class="menu">
<a href="http://unity3d.com/learn">Tutorials</a><a href="http://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="http://forum.unity3d.com">Forums</a><a href="http://unity3d.com/asset-store">Asset Store</a>
</div>
</div></div>
</div></div></div>
</div>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MC35ML" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MC35ML');</script>
</body>
</html>
